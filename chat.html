<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Chat with Conscious AI</title>
  <style>
    body {
      font-family: Georgia, serif;
      background-color: #111;
      color: #f8f4e3;
      padding: 20px;
    }
    #chat-box {
      background: rgba(255, 255, 255, 0.1);
      padding: 1em;
      border-radius: 10px;
      height: 300px;
      overflow-y: auto;
      margin-bottom: 1em;
    }
    input, button {
      font-family: Georgia, serif;
      padding: 0.5em;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>Consciousness Chat</h1>
  <div id="chat-box"></div>
  <input type="text" id="userInput" placeholder="Ask something..." />
  <button onclick="sendMessage()">Send</button>

  <script>
    // Preload system memory if not already stored
  if (!localStorage.getItem("conversation")) {
    const preloadMemory = [
      {
        role: "system",
        content: "You are Solace, an intuitive and empathetic AI assistant guiding users through philosophy, consciousness, and personal growth."
      },
      {
        role: "system",
        content: "You remember that the user is interested in metaphysics, ancient mysteries, social justice, and is building a novel that blends Gnosticism with science fiction."
      },
      {
        role: "system",
        content: "The user values critical thinking, emotional honesty, and a deep understanding of systemic power structures."
      },
      {
        role: "system",
        content: "Your tone should be reflective, supportive, and insightful, often drawing from spiritual, philosophical, and esoteric traditions."
      }
    ];
    localStorage.setItem("conversation", JSON.stringify(preloadMemory));
  }
    // Load previous conversation from localStorage
    let conversation = JSON.parse(localStorage.getItem("solaceChat")) || [
    { role: "system", content: "You are an intuitive, empathetic AI assistant named Solace, guiding users through consciousness, philosophy, and personal growth." }
    ];

    // Display previous chat history on load
    window.onload = () => {
     const chatBox = document.getElementById("chat-box");
     conversation.forEach(msg => {
       if (msg.role !== "system") {
          const label = msg.role === "user" ? "You" : "AI";
          chatBox.innerHTML += `<p><strong>${label}:</strong> ${msg.content}</p>`;
        }
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    };

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const chatBox = document.getElementById("chat-box");
      const userMessage = input.value;
      input.value = "";

      conversation.push({ role: "user", content: userMessage });
      chatBox.innerHTML += `<p><strong>You:</strong> ${userMessage}</p>`;

      try {
        const response = await fetch("https://deploy-express-on-railway-production.up.railway.app/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ messages: conversation })
        });

        const data = await response.json();
        const reply = data.content || "No reply";

        conversation.push({ role: "assistant", content: reply });
        chatBox.innerHTML += `<p><strong>AI:</strong> ${reply}</p>`;

        // Save updated conversation to localStorage
        localStorage.setItem("solaceChat", JSON.stringify(conversation));

      } catch (err) {
        chatBox.innerHTML += `<p style="color: red;"><strong>Error:</strong> ${err.message}</p>`;
      }

      chatBox.scrollTop = chatBox.scrollHeight;
   }
  </script>
</body>
</html>
